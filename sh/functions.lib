function get_popgun_info()
{
  PFILE=$SCRIPT_PATH/.popgun
  HOST=$(cat $PFILE | cut -d: -f1)
  PORT=$(cat $PFILE | cut -d: -f2)
  DB=$(cat $PFILE | cut -d: -f3)

  # hardcoding this in .popgun for now until I figure out a good way to do this
  USER=$(cat $PFILE | cut -d: -f4)
}

function get_ig_list()
{
  SQL_COMMAND="select instance_group || '.pg.mtmeprod.net' from pg.instance_groups where environment = 'prod' order by 1;"
  echo $(psql -AXt -h $HOST -d $DB -p $PORT -U $USER -c "$SQL_COMMAND")
}

function get_ig_list_rds()
{
  SQL_COMMAND="select endpoint || ':' || port from aws.rds_instances where engine in( 'postgres', 'aurora-postgresql' ) and ( is_writer = true or is_writer is null ) order by 1;"
  SQL_COMMAND="
	select	s.endpoint
	from	(
        	select  case when position( '. ' in cname ) > 0 then substring( cname, 1, position( '. ' in cname )-1 ) else case when cname = '' then endpoint else cname end end as endpoint
        	from    aws.rds_instances
        	where   engine in( 'postgres', 'aurora-postgresql' )
        	and     ( is_writer = true or is_writer is null )
        	and     endpoint not like '%euw1.%'
        	and     cname not like '%euw1.%'
        	and     status not in( 'stopped' )
		) s
	where	s.endpoint not in( 'salesdb.cauapsndyzmv.us-east-1.rds.amazonaws.com',
			'atlassian-confluence.cauapsndyzmv.us-east-1.rds.amazonaws.com',
			'atlassian-jira.cauapsndyzmv.us-east-1.rds.amazonaws.com',
			'content-classifier-pgsql.use1.amz.mtmeprod.com',
			'notes.use1.amz.mtmeprod.com',
			'operations.cauapsndyzmv.us-east-1.rds.amazonaws.com' )
        order by 1;"

  echo $(psql -AXt -h $HOST -d $DB -p $PORT -U $USER -c "$SQL_COMMAND")
}

function get_current_timestamp()
{
  SQL_COMMAND="select current_timestamp;"
  echo $(psql -AXt -h $HOST -d $DB -p $PORT -U $USER -c "$SQL_COMMAND")
}

